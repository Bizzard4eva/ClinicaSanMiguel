@model ClinicaSanMiguel.DTOs.ProfileResponseDto

@{
    ViewData["Title"] = "Dashboard - Clínica San Miguel";
}

<!-- Dashboard Section inspirado en 02_01.png -->
<section class="dashboard-section">
    <div class="container mt-4">
        
        <!-- Welcome Header -->
        <div class="welcome-header text-center mb-4">
            <h1 class="welcome-title text-primary">¡Bienvenido @Model.Nombre!</h1>
            <p class="welcome-subtitle text-muted">
                Aquí podrás reservar, pagar, reprogramar tus citas presenciales o teleconsultas y acceder a tu información de manera fácil y segura.
            </p>
            
            <!-- Reminder Alert -->
            <div class="alert alert-warning d-inline-flex align-items-center mb-4" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span>Recuerda elegir primero tu sede en el menú</span>
            </div>
        </div>

        <!-- Main Action Buttons -->
        <div class="main-actions text-center mb-5">
            <a href="@Url.Action("SelectPatient", "ReservaMedica")" class="btn btn-primary btn-lg me-3 mb-2">
                Reservar una cita presencial
            </a>
        </div>

        <div class="text-center mb-5">
            <a asp-action="UpdateProfile" asp-controller="Paciente" class="btn btn-primary">Editar Perfil</a>
            <a asp-action="Logout" asp-controller="Paciente" class="btn btn-danger">Cerrar Sesión</a>
        </div>


        <div class="row">
            <!-- Patient Profile Section -->
            <div class="col-md-6 mb-4">
                <div class="profile-section">
                    <!-- Profile Header -->
                    <div class="profile-header d-flex align-items-center mb-4">
                        <div class="profile-avatar me-3">
                            <img src="https://images.pexels.com/photos/5407249/pexels-photo-5407249.jpeg?auto=compress&cs=tinysrgb&w=150&h=150&fit=crop" 
                                 alt="Perfil" class="rounded-circle" width="80" height="80">
                        </div>
                        <div class="profile-info">
                            <h5 class="profile-name text-primary mb-1">Mi Perfil Clínico</h5>
                            <a href="@Url.Action("UpdateProfile", "Paciente")" class="profile-edit-link">
                                Editar mi perfil <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Patient Information Cards -->
                    <div class="patient-info-cards">
                        <div class="info-card mb-2">
                            <div class="info-row">
                                <span class="info-label">Sexo</span>
                                <span class="info-value">@Model.Genero</span>
                            </div>
                        </div>
                        
                        <div class="info-card mb-2">
                            <div class="info-row">
                                <span class="info-label">Edad</span>
                                <span class="info-value">@Model.Edad años</span>
                            </div>
                        </div>
                        
                        <div class="info-card mb-2">
                            <div class="info-row">
                                <span class="info-label">Peso</span>
                                <span class="info-value">@(Model.Peso.HasValue ? $"{Model.Peso} kg" : "No registrado")</span>
                            </div>
                        </div>
                        
                        <div class="info-card mb-2">
                            <div class="info-row">
                                <span class="info-label">Altura</span>
                                <span class="info-value">@(Model.Altura.HasValue ? $"{Model.Altura} m" : "No registrado")</span>
                            </div>
                        </div>
                        
                        <div class="info-card info-card-group">
                            <div class="info-row">
                                <span class="info-label">Grupo Sanguíneo</span>
                                <span class="info-value">@(string.IsNullOrEmpty(Model.GrupoSanguineo) ? "No registrado" : Model.GrupoSanguineo)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Tips Section -->
            <div class="col-md-6 mb-4">
                <div class="health-tips-section">
                    <div class="tips-header">
                        <h5 class="tips-title">Tips de Salud</h5>
                    </div>
                    
                    <div class="tips-carousel">
                        <div class="tip-card active">
                            <div class="tip-content">
                                <p class="tip-text">Recuerda que donar sangre es donar vida.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Appointments Section -->
        <div class="appointments-section mb-4">
            <div class="appointments-card">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#upcomingAppointments">
                    <h5 class="mb-0">
                        Citas Presenciales
                    </h5>
                </div>
                <div id="upcomingAppointments" class="collapse show">
                    <div class="card-body">
                        @{
                            var upcomingAppointments = ViewBag.UpcomingAppointments as List<ClinicaSanMiguel.DTOs.PatientAppointmentDto>;
                        }
                        @if (upcomingAppointments != null && upcomingAppointments.Any())
                        {
                            <div class="appointments-list">
                                @foreach (var appointment in upcomingAppointments)
                                {
                                    <div class="appointment-card mb-3">
                                        <div class="row align-items-center">
                                            <div class="col-md-2">
                                                <div class="appointment-date">
                                                    <div class="date-day">@appointment.FechaHora.ToString("dd")</div>
                                                    <div class="date-month">@appointment.FechaHora.ToString("MMM").ToUpper()</div>
                                                    <div class="date-time">@appointment.FechaHora.ToString("HH:mm")</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="appointment-info">
                                                    <h6 class="appointment-specialty">@appointment.Especialidad</h6>
                                                    <p class="appointment-doctor mb-1"><strong>Dr(a). @appointment.Medico</strong></p>
                                                    <p class="appointment-clinic mb-1"><i class="fas fa-map-marker-alt me-1"></i>@appointment.Clinica</p>
                                                    <p class="appointment-patient mb-0"><i class="fas fa-user me-1"></i>@appointment.Paciente</p>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="appointment-insurance">
                                                    <span class="insurance-badge">@appointment.Seguro</span>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="appointment-actions">
                                                    <span class="status-badge status-@appointment.Estado.ToLower().Replace(" ", "-")">@appointment.Estado</span>
                                                    <div class="appointment-price">S/ @appointment.Precio.ToString("F2")</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted text-center py-3">No tiene citas programadas por el momento.</p>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Appointments History Section -->
        <div class="appointments-history-section mb-4">
            <div class="history-card">
                <div class="card-header" data-bs-toggle="collapse" data-bs-target="#appointmentsHistory">
                    <h5 class="mb-0">
                        Historial de Citas Presenciales
                    </h5>
                </div>
                <div id="appointmentsHistory" class="collapse">
                    <div class="card-body">
                        @{
                            var appointmentHistory = ViewBag.AppointmentHistory as List<ClinicaSanMiguel.DTOs.PatientAppointmentDto>;
                        }
                        @if (appointmentHistory != null && appointmentHistory.Any())
                        {
                            <div class="appointments-history-list">
                                @foreach (var appointment in appointmentHistory.OrderByDescending(a => a.FechaHora))
                                {
                                    <div class="history-appointment-card mb-3">
                                        <div class="row align-items-center">
                                            <div class="col-md-2">
                                                <div class="history-appointment-date">
                                                    <div class="history-date-day">@appointment.FechaHora.ToString("dd")</div>
                                                    <div class="history-date-month">@appointment.FechaHora.ToString("MMM").ToUpper()</div>
                                                    <div class="history-date-year">@appointment.FechaHora.ToString("yyyy")</div>
                                                    <div class="history-date-time">@appointment.FechaHora.ToString("HH:mm")</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="history-appointment-info">
                                                    <h6 class="history-appointment-specialty">@appointment.Especialidad</h6>
                                                    <p class="history-appointment-doctor mb-1"><strong>Dr(a). @appointment.Medico</strong></p>
                                                    <p class="history-appointment-clinic mb-1"><i class="fas fa-map-marker-alt me-1"></i>@appointment.Clinica</p>
                                                    <p class="history-appointment-patient mb-0"><i class="fas fa-user me-1"></i>@appointment.Paciente</p>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="history-appointment-insurance">
                                                    <span class="history-insurance-badge">@appointment.Seguro</span>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="history-appointment-actions">
                                                    <span class="history-status-badge history-status-@appointment.Estado.ToLower().Replace(" ", "-")">@appointment.Estado</span>
                                                    <div class="history-appointment-price">S/ @appointment.Precio.ToString("F2")</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted text-center py-3">No hay historial de citas disponible.</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.dashboard-section {
    padding: 20px 0;
    background-color: #f8f9fa;
    min-height: 80vh;
}

.welcome-title {
    font-size: 2rem;
    font-weight: 600;
    color: #7b2d8e;
}

.welcome-subtitle {
    font-size: 1rem;
    max-width: 800px;
    margin: 0 auto 20px;
}

.main-actions .btn {
    padding: 12px 30px;
    font-size: 1rem;
    font-weight: 500;
    border-radius: 25px;
}

.profile-section {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.profile-avatar img {
    border: 3px solid #e9ecef;
}

.profile-name {
    font-size: 1.2rem;
    font-weight: 600;
}

.profile-edit-link {
    color: #7b2d8e;
    text-decoration: none;
    font-size: 0.9rem;
}

.profile-edit-link:hover {
    color: #5a1f68;
    text-decoration: underline;
}

.patient-info-cards .info-card {
    background: #f8f6ff;
    border-radius: 8px;
    padding: 12px 15px;
    border-left: 4px solid #c8a8d8;
}

.patient-info-cards .info-card-group {
    background: #c8a8d8;
    color: white;
    border-left: 4px solid #7b2d8e;
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.info-label {
    font-weight: 500;
    color: #6c757d;
}

.info-card-group .info-label {
    color: white;
}

.info-value {
    font-weight: 600;
    color: #495057;
}

.info-card-group .info-value {
    color: white;
}

.health-tips-section {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    height: 100%;
}

.tips-title {
    background: #ffc107;
    color: #000;
    padding: 10px 20px;
    border-radius: 20px;
    text-align: center;
    font-weight: 600;
    margin-bottom: 20px;
}

.tip-card {
    background: #fff3cd;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    position: relative;
}

.tip-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.tip-text {
    flex: 1;
    margin: 0;
    font-size: 1rem;
    color: #856404;
    font-weight: 500;
}

.tip-nav-prev, .tip-nav-next {
    color: #7b2d8e;
    cursor: pointer;
    font-size: 1.2rem;
    padding: 10px;
}

.tip-nav-prev:hover, .tip-nav-next:hover {
    color: #5a1f68;
}

.appointments-card, .history-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
}

.appointments-card .card-header, .history-card .card-header {
    background: #7b2d8e;
    color: white;
    padding: 15px 20px;
    cursor: pointer;
    border: none;
}

.appointments-card .card-header h5, .history-card .card-header h5 {
    margin: 0;
    font-weight: 600;
}

.card-body {
    padding: 20px;
}

/* Appointment Cards Styles */
.appointment-card {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 15px;
    border-left: 4px solid #7b2d8e;
    transition: all 0.3s ease;
}

.appointment-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.appointment-date {
    background: #7b2d8e;
    color: white;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    min-width: 80px;
}

.date-day {
    font-size: 1.5rem;
    font-weight: bold;
}

.date-month {
    font-size: 0.8rem;
    font-weight: 500;
}

.date-time {
    font-size: 0.9rem;
    margin-top: 2px;
}

.appointment-specialty {
    color: #7b2d8e;
    font-weight: 600;
    margin-bottom: 5px;
}

.appointment-doctor {
    color: #495057;
    font-size: 0.95rem;
}

.appointment-clinic, .appointment-patient {
    color: #6c757d;
    font-size: 0.9rem;
}

.insurance-badge {
    background: #28a745;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-badge {
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
    text-transform: uppercase;
}

.status-programada {
    background: #17a2b8;
    color: white;
}

.status-confirmada {
    background: #28a745;
    color: white;
}

.status-cancelada {
    background: #dc3545;
    color: white;
}

.status-reprogramada {
    background: #ffc107;
    color: #212529;
}

.appointment-price {
    font-weight: bold;
    color: #7b2d8e;
    margin-top: 5px;
}

/* History Appointment Cards Styles */
.history-appointment-card {
    background: #ffffff;
    border-radius: 8px;
    padding: 12px;
    border-left: 3px solid #6c757d;
    border: 1px solid #e9ecef;
}

.history-appointment-date {
    background: #6c757d;
    color: white;
    border-radius: 6px;
    padding: 8px;
    text-align: center;
    min-width: 75px;
}

.history-date-day {
    font-size: 1.3rem;
    font-weight: bold;
}

.history-date-month {
    font-size: 0.7rem;
    font-weight: 500;
}

.history-date-year {
    font-size: 0.7rem;
}

.history-date-time {
    font-size: 0.8rem;
    margin-top: 2px;
}

.history-appointment-specialty {
    color: #495057;
    font-weight: 500;
    margin-bottom: 4px;
    font-size: 1rem;
}

.history-appointment-doctor {
    color: #495057;
    font-size: 0.9rem;
}

.history-appointment-clinic, .history-appointment-patient {
    color: #6c757d;
    font-size: 0.85rem;
}

.history-insurance-badge {
    background: #6c757d;
    color: white;
    padding: 3px 6px;
    border-radius: 10px;
    font-size: 0.75rem;
    font-weight: 500;
}

.history-status-badge {
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
}

.history-status-completada {
    background: #28a745;
    color: white;
}

.history-status-cancelada {
    background: #dc3545;
    color: white;
}

.history-status-no-asistio {
    background: #6c757d;
    color: white;
}

.history-appointment-price {
    font-weight: 500;
    color: #495057;
    margin-top: 4px;
    font-size: 0.9rem;
}
</style>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Handle collapsible sections
            $('.card-header').click(function() {
                const target = $(this).data('bs-target');
                const icon = $(this).find('.float-end');
                
                if ($(target).hasClass('show')) {
                    icon.removeClass('fa-chevron-up').addClass('fa-chevron-down');
                } else {
                    icon.removeClass('fa-chevron-down').addClass('fa-chevron-up');
                }
            });

            // Health tips navigation (placeholder for future implementation)
            $('.tip-nav-prev, .tip-nav-next').click(function() {
                // Future: implement tip carousel navigation
                console.log('Navigating health tips');
            });
        });
    </script>
}