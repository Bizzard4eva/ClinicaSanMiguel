@model ClinicaSanMiguel.DTOs.UpdateProfileRequestDto

@{
    ViewData["Title"] = "Editar Perfil - Clínica San Miguel";
}

<!-- Editar Perfil Section -->
<section class="appointment-section">
    <div class="container">

        <!-- Título de la página -->
        <div class="page-title text-center mb-4">
            <h1 class="text-primary">Editar Perfil Médico</h1>
            <p class="text-muted">Actualiza tu información clínica para un mejor servicio.</p>
        </div>

        <!-- Formulario de edición -->
        <div class="profile-edit-container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="edit-card">
                        <form asp-controller="Paciente" asp-action="UpdateProfile" method="post" id="profileForm">
                            <input type="hidden" asp-for="IdPaciente" />

                            <!-- Género -->
                            <div class="form-group mb-4">
                                <label asp-for="IdGenero" class="form-label">Género</label>
                                <select asp-for="IdGenero" class="form-select">
                                    <option value="">SELECCIONE SU GÉNERO</option>
                                    <option value="1">Masculino</option>
                                    <option value="2">Femenino</option>
                                </select>
                                <span asp-validation-for="IdGenero" class="text-danger"></span>
                            </div>

                            <!-- Peso -->
                            <div class="form-group mb-4">
                                <label asp-for="Peso" class="form-label">Peso (kg)</label>
                                <input asp-for="Peso" class="form-control" type="number" step="0.01" min="1" max="300" 
                                       placeholder="Ingrese su peso en kilogramos" />
                                <span asp-validation-for="Peso" class="text-danger"></span>
                            </div>

                            <!-- Altura -->
                            <div class="form-group mb-4">
                                <label asp-for="Altura" class="form-label">Altura (metros)</label>
                                <input asp-for="Altura" class="form-control" type="number" step="0.01" min="0.5" max="3.0"
                                       placeholder="Ej: 1.75" />
                                <span asp-validation-for="Altura" class="text-danger"></span>
                            </div>

                            <!-- Grupo Sanguíneo -->
                            <div class="form-group mb-4">
                                <label asp-for="IdTipoSangre" class="form-label">Grupo Sanguíneo</label>
                                <select asp-for="IdTipoSangre" class="form-select" asp-items="@(new SelectList(ViewBag.TiposSangre, "idTipoSangre", "tipoSangre"))">
                                    <option value="">SELECCIONE SU TIPO DE SANGRE</option>
                                </select>
                                <span asp-validation-for="IdTipoSangre" class="text-danger"></span>
                            </div>

                            <!-- Mensajes de error -->
                            @if (ViewBag.Error != null)
                            {
                                <div class="alert alert-danger mb-4">
                                    @ViewBag.Error
                                </div>
                            }

                            <!-- Información adicional -->
                            <div class="info-section mb-4">
                                <div class="alert alert-info">
                                    <strong>Información importante:</strong> Estos datos médicos nos ayudan a brindarle un mejor servicio de salud.
                                </div>
                            </div>

                            <!-- Botones de acción -->
                            <div class="action-buttons text-center">
                                <a asp-controller="Paciente" asp-action="Dashboard" class="btn btn-outline-secondary me-3">
                                    Cancelar
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    Guardar Cambios
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.appointment-section {
    padding: 40px 0;
    background-color: #f8f9fa;
    min-height: 80vh;
}

.page-title h1 {
    font-size: 2rem;
    font-weight: 600;
    color: #7b2d8e;
}

.page-title p {
    font-size: 1rem;
    max-width: 600px;
    margin: 0 auto;
}

.edit-card {
    background: white;
    border-radius: 15px;
    padding: 40px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    padding: 12px 16px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #7b2d8e;
    box-shadow: 0 0 0 0.2rem rgba(123, 45, 142, 0.25);
}

.form-control::placeholder {
    color: #6c757d;
    font-style: italic;
}

.info-section .alert {
    border-left: 4px solid #17a2b8;
    background-color: #d1ecf1;
    border-color: #b8daff;
    color: #0c5460;
}

.action-buttons .btn {
    padding: 12px 30px;
    font-size: 1rem;
    font-weight: 500;
    border-radius: 25px;
    min-width: 140px;
}

.btn-primary {
    background-color: #7b2d8e;
    border-color: #7b2d8e;
}

.btn-primary:hover {
    background-color: #5a1f68;
    border-color: #5a1f68;
}

.text-danger {
    font-size: 0.875rem;
    margin-top: 5px;
}

.alert {
    border-radius: 10px;
}
</style>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Validación en tiempo real
            $('#profileForm').on('input change', 'input, select', function() {
                var $input = $(this);
                var value = $input.val();
                
                // Limpiar mensajes de error previos
                $input.siblings('.text-danger').hide();
                
                // Validaciones específicas
                if ($input.attr('name') === 'Peso') {
                    if (value && (value < 1 || value > 300)) {
                        showFieldError($input, 'El peso debe estar entre 1 y 300 kg');
                    }
                }
                
                if ($input.attr('name') === 'Altura') {
                    if (value && (value < 0.5 || value > 3.0)) {
                        showFieldError($input, 'La altura debe estar entre 0.5 y 3.0 metros');
                    }
                }
            });
            
            // Función para mostrar errores de campo
            function showFieldError($input, message) {
                var $error = $input.siblings('.text-danger');
                if ($error.length === 0) {
                    $error = $('<span class="text-danger"></span>');
                    $input.after($error);
                }
                $error.text(message).show();
            }
            
            // Validación del formulario antes del envío
            $('#profileForm').on('submit', function(e) {
                var isValid = true;
                var $form = $(this);
                
                // Limpiar errores previos
                $form.find('.text-danger').hide();
                
                // Validar que al menos un campo esté lleno
                var peso = $('input[name="Peso"]').val();
                var altura = $('input[name="Altura"]').val();
                var genero = $('select[name="IdGenero"]').val();
                var tipoSangre = $('select[name="IdTipoSangre"]').val();
                
                if (!peso && !altura && !genero && !tipoSangre) {
                    alert('Debe completar al menos un campo para actualizar su perfil.');
                    isValid = false;
                }
                
                if (!isValid) {
                    e.preventDefault();
                }
            });
        });
    </script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

@if (TempData["Mensaje"] != null)
{
    <script>
        $(document).ready(function() {
            alert('@TempData["Mensaje"]');
        });
    </script>
}
